@model IEnumerable<Proy_DSWI_NinaJose.Models.Producto>
@{
    ViewData["Title"] = "Catálogo de Productos";
    Layout = "_Layout";
}
<link rel="stylesheet" href="~/css/IndexProductos.css" />

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-0">@ViewData["Title"]</h2>
        <p class="text-muted">Descubre nuestras piezas únicas de Artesanía Peruana</p>
    </div>
    @if (User.IsInRole("Admin"))
    {
        <a asp-controller="Producto"
           asp-action="CreateProducto"
           class="btn btn-success">
            <i class="bi bi-plus-circle me-1"></i>Agregar producto
        </a>
    }
</div>

<div class="catalog-grid">
    @foreach (var prod in Model)
    {
        <div class="catalog-card">
            <img src="@prod.ImagenUrl" alt="@prod.Nombre"
                 onerror="this.onerror=null;this.src='/images/no-image.png';" />
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">@prod.Nombre</h5>
                <p class="card-text text-truncate">@prod.Descripcion</p>
                <p class="price">S/ @prod.Precio.ToString("F2")</p>
                <div class="mt-auto d-grid gap-2">
                    <button class="btn btn-outline-details"
                            onclick="showDetails('@Url.Action("DetailsProducto","Producto", new { id = prod.IdProducto })')">
                        Detalles
                    </button>

                    @if (User.IsInRole("Cliente"))
                    {
                        <button type="button"
                                class="btn btn-cart index-add-btn"
                                data-id="@prod.IdProducto">
                            <i class="bi bi-cart-plus me-1"></i>Añadir al carrito
                        </button>
                    }
                    else if (User.Identity.IsAuthenticated)
                    {
                        <span class="text-muted d-block text-center">Sin permiso</span>
                    }
                    else
                    {
                        <button type="button"
                                class="btn btn-cart"
                                onclick="showLoginModal()">
                            <i class="bi bi-cart-plus me-1"></i>Añadir al carrito
                        </button>
                    }
                </div>
            </div>
        </div>
    }
</div>
